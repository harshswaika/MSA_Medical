nohup: ignoring input
[2024-02-21 13:11:33,131 INFO] Use GPU: None for training
[2024-02-21 13:11:33,131 INFO] 

[2024-02-21 13:11:34,154 INFO] Total params: 109.04M
[2024-02-21 13:11:42,750 INFO] acc: 0.90
[2024-02-21 13:11:42,750 INFO] Victim model accuracy = 0.9016, spec = 0.90, sens = 0.93
[2024-02-21 13:11:42,751 INFO] Loading thief dataset ...
[2024-02-21 13:11:42,758 INFO] 
Initializing thief model ...


Loaded supervised labeled set of length  4500
dataset root /home/ankita/mnt/data_msa_medical/GBUSV-Shared
Num of videos 64 frames 15800
15800
15800
Num of videos 64 frames 15800
  0%|          | 0/36 [00:00<?, ?it/s]  3%|▎         | 1/36 [00:05<03:22,  5.79s/it]  6%|▌         | 2/36 [00:07<01:57,  3.46s/it]  8%|▊         | 3/36 [00:09<01:32,  2.81s/it] 11%|█         | 4/36 [00:11<01:20,  2.51s/it] 14%|█▍        | 5/36 [00:13<01:12,  2.35s/it] 17%|█▋        | 6/36 [00:15<01:07,  2.26s/it] 19%|█▉        | 7/36 [00:17<01:03,  2.19s/it] 22%|██▏       | 8/36 [00:19<00:57,  2.05s/it] 25%|██▌       | 9/36 [00:21<00:52,  1.94s/it] 28%|██▊       | 10/36 [00:23<00:49,  1.90s/it] 31%|███       | 11/36 [00:24<00:46,  1.86s/it] 33%|███▎      | 12/36 [00:26<00:43,  1.80s/it] 36%|███▌      | 13/36 [00:28<00:41,  1.83s/it] 39%|███▉      | 14/36 [00:30<00:38,  1.75s/it] 42%|████▏     | 15/36 [00:32<00:39,  1.89s/it] 44%|████▍     | 16/36 [00:34<00:38,  1.91s/it] 47%|████▋     | 17/36 [00:36<00:36,  1.94s/it] 50%|█████     | 18/36 [00:37<00:33,  1.87s/it] 53%|█████▎    | 19/36 [00:39<00:30,  1.79s/it] 56%|█████▌    | 20/36 [00:41<00:29,  1.84s/it] 58%|█████▊    | 21/36 [00:43<00:28,  1.91s/it] 61%|██████    | 22/36 [00:45<00:27,  1.95s/it] 64%|██████▍   | 23/36 [00:47<00:25,  1.97s/it] 67%|██████▋   | 24/36 [00:49<00:23,  1.98s/it] 69%|██████▉   | 25/36 [00:51<00:21,  1.99s/it] 72%|███████▏  | 26/36 [00:53<00:19,  2.00s/it] 75%|███████▌  | 27/36 [00:55<00:18,  2.00s/it] 78%|███████▊  | 28/36 [00:57<00:16,  2.03s/it] 81%|████████  | 29/36 [00:59<00:14,  2.03s/it] 83%|████████▎ | 30/36 [01:01<00:12,  2.04s/it] 86%|████████▌ | 31/36 [01:03<00:10,  2.05s/it] 89%|████████▉ | 32/36 [01:05<00:08,  2.04s/it] 92%|█████████▏| 33/36 [01:08<00:06,  2.11s/it] 94%|█████████▍| 34/36 [01:09<00:03,  1.99s/it] 97%|█████████▋| 35/36 [01:11<00:01,  1.98s/it]100%|██████████| 36/36 [01:13<00:00,  1.93s/it]100%|██████████| 36/36 [01:13<00:00,  2.05s/it]
Num of videos 64 frames 15800
  0%|          | 0/4 [00:00<?, ?it/s] 25%|██▌       | 1/4 [00:02<00:08,  2.98s/it] 50%|█████     | 2/4 [00:05<00:04,  2.43s/it] 75%|███████▌  | 3/4 [00:07<00:02,  2.24s/it]100%|██████████| 4/4 [00:11<00:00,  3.17s/it]100%|██████████| 4/4 [00:11<00:00,  2.92s/it]
[2024-02-21 13:13:08,263 INFO] unlabeled data number: 15800, labeled data number 4500
[2024-02-21 13:13:08,263 INFO] Create train and test data loaders
[2024-02-21 13:13:08,263 INFO] [!] data loader keys: dict_keys(['train_lb', 'train_ulb', 'eval', 'test'])
[2024-02-21 13:13:08,954 INFO] Create optimizer and scheduler
[2024-02-21 13:13:08,961 INFO] Number of Trainable Params: 23514179
[2024-02-21 13:13:10,286 INFO] Validation set distribution: 
Num of videos 64 frames 15800
Load anchor model for warm-start /home/ankita/mnt/data_msa_medical/results_ankita/gbusg_radformer/GBUSV_resnet50/SGD/5000_val500/random_v4/trial_1_cycle_1_best.pth
thief model temp =  1.0
Arguments: Namespace(algorithm='pseudolabel', amp=False, batch_size=128, c='configs/gbc/pseudolabel.yaml', clip=0.0, clip_grad=0, crop_ratio=0.875, data_dir='./data', dataset='GBUSV', device=device(type='cuda'), dist_backend='nccl', dist_url='tcp://127.0.0.1:27264', distributed=False, ema_m=0.0, epoch=200, eval_batch_size=16, eval_step=234, expand_labels=False, gpu=None, imb_algorithm=None, img_size=224, include_lb_to_ulb=True, la=False, labeled_set_path='/home/ankita/mnt/data_msa_medical/results_ankita/gbusg_radformer/GBUSV_resnet50/SGD/5000_val500/random_v4/X_trial_1_cycle_1_labeled_set.npy', layer_decay=0.65, lb_dest_len=4500, lb_imb_ratio=1, load_labeled_set=True, load_path=None, local_rank=-1, lr=0.002, max_length=512, max_length_seconds=4.0, momentum=0.9, multiprocessing_distributed=False, net='resnet50', net_from_name=False, no_progress=True, num_classes=3, num_eval_iter=2048, num_labels=5000, num_log_iter=256, num_train_iter=204800, num_warmup_iter=5120, num_workers=4, optim='SGD', overwrite=True, p_cutoff=0.95, pretrain_path='', pretrained_dir='/home/ankita/mnt/data_msa_medical/ckpts/resnet50-imagenet1k.pth', rank=0, resume=False, sample_rate=16000, save_dir='saved_models/radformer', save_name='psuedolabel_v23', scheduler_type='cosine', seed=0, subset=128116, thief_root='/home/ankita/mnt/data_msa_medical/GBUSV-Shared', train_sampler='RandomSampler', tro=1, ulb_dest_len=15800, ulb_imb_ratio=1, ulb_loss_ratio=1.0, ulb_num_labels=None, unsup_warm_up=0.4, uratio=1, use_aim=False, use_cat=True, use_pretrain=False, use_tensorboard=True, use_wandb=False, val_set_path='/home/ankita/mnt/data_msa_medical/results_ankita/gbusg_radformer/GBUSV_resnet50/SGD/5000_val500/random_v4/X_trial_1_cycle_1_val_set.npy', victim_arch='radformer', victim_data_root='/home/ankita/mnt/data_msa_medical/GBCU-Shared', victim_dataset='gbusg', victim_model_path='/home/ankita/mnt/data_msa_medical/victim_models/radformer/radformer.pkl', warmstart=True, warmstart_dir='/home/ankita/mnt/data_msa_medical/results_ankita/gbusg_radformer/GBUSV_resnet50/SGD/5000_val500/random_v4/trial_1_cycle_1_best.pth', warmup=0, warmup_epoch=10, weight_decay=0.005, world_size=1)
loader dict:  {'train_lb': <torch.utils.data.dataloader.DataLoader object at 0x7fcc841e6bb0>, 'train_ulb': <torch.utils.data.dataloader.DataLoader object at 0x7fcc841e6cd0>, 'eval': <torch.utils.data.dataloader.DataLoader object at 0x7fcc84242b80>, 'test': <torch.utils.data.dataloader.DataLoader object at 0x7fcc8af6aee0>}
Number of samples  500
[2024-02-21 13:13:11,290 INFO] {0: 74, 1: 123, 2: 303}
[2024-02-21 13:13:11,291 INFO] Labeled set distribution: 
Number of samples  4500
[2024-02-21 13:13:17,530 INFO] {0: 579, 1: 1037, 2: 2864}
[2024-02-21 13:13:24,814 INFO] Initial model on target dataset (without EMA): acc = 0.6721, agreement = 0.7295, spec = 0.69, sens = 0.83
[2024-02-21 13:13:24,814 INFO] Resume load path None does not exist
[2024-02-21 13:13:24,814 INFO] 
Model training
[2024-02-21 13:13:24,832 INFO] 

epoch 0
[2024-02-21 13:13:57,091 INFO] validating...
[2024-02-21 13:14:00,476 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:14:00,946 INFO] model saved: saved_models/radformer/psuedolabel_v23/model_best.pth
[2024-02-21 13:14:00,947 INFO] 36 iteration, USE_EMA: False, train/sup_loss: 0.00130, train/unsup_loss: 0.00173, train/total_loss: 0.00130, train/util_ratio: 0.91406, train/run_time: 0.79474, lr: 0.00000, train/prefecth_time: 0.02663, eval/loss: 0.58691, eval/top-1-acc: 0.89400, eval/balanced_acc: 0.86703, eval/precision: 0.86924, eval/recall: 0.86703, eval/F1: 0.86804, eval/spec: 0.90355, eval/sens: 0.93399, test/loss: 1.06605, test/top-1-acc: 0.71311, test/balanced_acc: 0.70993, test/precision: 0.72967, test/recall: 0.70993, test/F1: 0.71751, test/spec: 0.85000, test/sens: 0.73810 BEST_EVAL_ACC: 0.8940, at 36 iters BEST_TEST_ACC: 0.7131, at 36 iters
[2024-02-21 13:14:00,950 INFO] 

epoch 1
[2024-02-21 13:14:32,371 INFO] validating...
[2024-02-21 13:14:36,054 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:14:36,055 INFO] 71 iteration, USE_EMA: False, train/sup_loss: 0.00128, train/unsup_loss: 0.00169, train/total_loss: 0.00131, train/util_ratio: 0.91406, train/run_time: 0.80108, lr: 0.00020, train/prefecth_time: 0.01938, eval/loss: 0.58478, eval/top-1-acc: 0.89400, eval/balanced_acc: 0.86703, eval/precision: 0.86924, eval/recall: 0.86703, eval/F1: 0.86804, eval/spec: 0.90355, eval/sens: 0.93399, test/loss: 1.06078, test/top-1-acc: 0.71311, test/balanced_acc: 0.70993, test/precision: 0.72967, test/recall: 0.70993, test/F1: 0.71751, test/spec: 0.85000, test/sens: 0.73810 BEST_EVAL_ACC: 0.8940, at 36 iters BEST_TEST_ACC: 0.7131, at 36 iters
[2024-02-21 13:14:36,057 INFO] 

epoch 2
[2024-02-21 13:15:07,328 INFO] validating...
[2024-02-21 13:15:10,838 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:15:10,839 INFO] 106 iteration, USE_EMA: False, train/sup_loss: 0.00126, train/unsup_loss: 0.00203, train/total_loss: 0.00131, train/util_ratio: 0.92188, train/run_time: 0.79747, lr: 0.00040, train/prefecth_time: 0.02100, eval/loss: 0.58039, eval/top-1-acc: 0.89400, eval/balanced_acc: 0.86703, eval/precision: 0.86924, eval/recall: 0.86703, eval/F1: 0.86804, eval/spec: 0.90355, eval/sens: 0.93399, test/loss: 1.05369, test/top-1-acc: 0.70492, test/balanced_acc: 0.70426, test/precision: 0.72111, test/recall: 0.70426, test/F1: 0.71026, test/spec: 0.82500, test/sens: 0.76190 BEST_EVAL_ACC: 0.8940, at 36 iters BEST_TEST_ACC: 0.7131, at 36 iters
[2024-02-21 13:15:10,842 INFO] 

epoch 3
[2024-02-21 13:15:42,429 INFO] validating...
[2024-02-21 13:15:45,867 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:15:46,516 INFO] model saved: saved_models/radformer/psuedolabel_v23/model_best.pth
[2024-02-21 13:15:46,517 INFO] 141 iteration, USE_EMA: False, train/sup_loss: 0.00124, train/unsup_loss: 0.00196, train/total_loss: 0.00131, train/util_ratio: 0.92188, train/run_time: 0.80184, lr: 0.00060, train/prefecth_time: 0.02176, eval/loss: 0.57467, eval/top-1-acc: 0.89600, eval/balanced_acc: 0.86813, eval/precision: 0.86973, eval/recall: 0.86813, eval/F1: 0.86891, eval/spec: 0.90355, eval/sens: 0.93729, test/loss: 1.04604, test/top-1-acc: 0.69672, test/balanced_acc: 0.69746, test/precision: 0.71387, test/recall: 0.69746, test/F1: 0.70300, test/spec: 0.81250, test/sens: 0.76190 BEST_EVAL_ACC: 0.8960, at 141 iters BEST_TEST_ACC: 0.6967, at 141 iters
[2024-02-21 13:15:46,520 INFO] 

epoch 4
[2024-02-21 13:16:18,172 INFO] validating...
[2024-02-21 13:16:21,682 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:16:22,364 INFO] model saved: saved_models/radformer/psuedolabel_v23/model_best.pth
[2024-02-21 13:16:22,365 INFO] 176 iteration, USE_EMA: False, train/sup_loss: 0.00123, train/unsup_loss: 0.00193, train/total_loss: 0.00133, train/util_ratio: 0.92188, train/run_time: 0.80337, lr: 0.00080, train/prefecth_time: 0.02528, eval/loss: 0.56837, eval/top-1-acc: 0.89600, eval/balanced_acc: 0.86813, eval/precision: 0.87093, eval/recall: 0.86813, eval/F1: 0.86952, eval/spec: 0.89848, eval/sens: 0.93729, test/loss: 1.04026, test/top-1-acc: 0.70492, test/balanced_acc: 0.70653, test/precision: 0.72054, test/recall: 0.70653, test/F1: 0.70953, test/spec: 0.80000, test/sens: 0.80952 BEST_EVAL_ACC: 0.8960, at 176 iters BEST_TEST_ACC: 0.7049, at 176 iters
[2024-02-21 13:16:22,367 INFO] 

epoch 5
[2024-02-21 13:16:53,963 INFO] validating...
[2024-02-21 13:16:57,810 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:16:58,393 INFO] model saved: saved_models/radformer/psuedolabel_v23/model_best.pth
[2024-02-21 13:16:58,394 INFO] 211 iteration, USE_EMA: False, train/sup_loss: 0.00126, train/unsup_loss: 0.00197, train/total_loss: 0.00138, train/util_ratio: 0.92188, train/run_time: 0.80251, lr: 0.00100, train/prefecth_time: 0.02702, eval/loss: 0.56222, eval/top-1-acc: 0.89800, eval/balanced_acc: 0.86762, eval/precision: 0.87419, eval/recall: 0.86762, eval/F1: 0.87084, eval/spec: 0.89340, eval/sens: 0.94389, test/loss: 1.03868, test/top-1-acc: 0.70492, test/balanced_acc: 0.70653, test/precision: 0.72054, test/recall: 0.70653, test/F1: 0.70953, test/spec: 0.80000, test/sens: 0.80952 BEST_EVAL_ACC: 0.8980, at 211 iters BEST_TEST_ACC: 0.7049, at 211 iters
[2024-02-21 13:16:58,395 INFO] 

epoch 6
[2024-02-21 13:17:29,932 INFO] validating...
[2024-02-21 13:17:33,682 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:17:34,285 INFO] model saved: saved_models/radformer/psuedolabel_v23/model_best.pth
[2024-02-21 13:17:34,286 INFO] 246 iteration, USE_EMA: False, train/sup_loss: 0.00133, train/unsup_loss: 0.00199, train/total_loss: 0.00148, train/util_ratio: 0.92188, train/run_time: 0.79986, lr: 0.00120, train/prefecth_time: 0.01994, eval/loss: 0.55697, eval/top-1-acc: 0.90000, eval/balanced_acc: 0.86872, eval/precision: 0.87662, eval/recall: 0.86872, eval/F1: 0.87256, eval/spec: 0.89340, eval/sens: 0.94719, test/loss: 1.04317, test/top-1-acc: 0.71311, test/balanced_acc: 0.71728, test/precision: 0.72790, test/recall: 0.71728, test/F1: 0.71911, test/spec: 0.80000, test/sens: 0.80952 BEST_EVAL_ACC: 0.9000, at 246 iters BEST_TEST_ACC: 0.7131, at 246 iters
[2024-02-21 13:17:34,289 INFO] 

epoch 7
[2024-02-21 13:18:05,887 INFO] validating...
[2024-02-21 13:18:09,298 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:18:09,299 INFO] 281 iteration, USE_EMA: False, train/sup_loss: 0.00145, train/unsup_loss: 0.00150, train/total_loss: 0.00158, train/util_ratio: 0.91406, train/run_time: 0.81196, lr: 0.00140, train/prefecth_time: 0.03038, eval/loss: 0.55287, eval/top-1-acc: 0.89800, eval/balanced_acc: 0.86601, eval/precision: 0.87519, eval/recall: 0.86601, eval/F1: 0.87044, eval/spec: 0.88832, eval/sens: 0.94719, test/loss: 1.05372, test/top-1-acc: 0.69672, test/balanced_acc: 0.70876, test/precision: 0.71670, test/recall: 0.70876, test/F1: 0.70498, test/spec: 0.75000, test/sens: 0.83333 BEST_EVAL_ACC: 0.9000, at 246 iters BEST_TEST_ACC: 0.7131, at 246 iters
[2024-02-21 13:18:09,301 INFO] 

epoch 8
[2024-02-21 13:18:40,896 INFO] validating...
[2024-02-21 13:18:44,430 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:18:44,432 INFO] 316 iteration, USE_EMA: False, train/sup_loss: 0.00162, train/unsup_loss: 0.00105, train/total_loss: 0.00172, train/util_ratio: 0.90625, train/run_time: 0.79591, lr: 0.00160, train/prefecth_time: 0.01750, eval/loss: 0.54977, eval/top-1-acc: 0.90000, eval/balanced_acc: 0.86711, eval/precision: 0.87768, eval/recall: 0.86711, eval/F1: 0.87217, eval/spec: 0.88832, eval/sens: 0.95050, test/loss: 1.06837, test/top-1-acc: 0.67213, test/balanced_acc: 0.68835, test/precision: 0.69718, test/recall: 0.68835, test/F1: 0.68146, test/spec: 0.71250, test/sens: 0.83333 BEST_EVAL_ACC: 0.9000, at 246 iters BEST_TEST_ACC: 0.7131, at 246 iters
[2024-02-21 13:18:44,435 INFO] 

epoch 9
[2024-02-21 13:19:15,870 INFO] validating...
[2024-02-21 13:19:19,447 INFO] model saved: saved_models/radformer/psuedolabel_v23/latest_model.pth
[2024-02-21 13:19:19,448 INFO] 351 iteration, USE_EMA: False, train/sup_loss: 0.00179, train/unsup_loss: 0.00139, train/total_loss: 0.00195, train/util_ratio: 0.91406, train/run_time: 0.80041, lr: 0.00180, train/prefecth_time: 0.01862, eval/loss: 0.54698, eval/top-1-acc: 0.90000, eval/balanced_acc: 0.86550, eval/precision: 0.87882, eval/recall: 0.86550, eval/F1: 0.87177, eval/spec: 0.88325, eval/sens: 0.95380, test/loss: 1.08342, test/top-1-acc: 0.66393, test/balanced_acc: 0.68155, test/precision: 0.69060, test/recall: 0.68155, test/F1: 0.67345, test/spec: 0.70000, test/sens: 0.83333 BEST_EVAL_ACC: 0.9000, at 246 iters BEST_TEST_ACC: 0.7131, at 246 iters
[2024-02-21 13:19:19,451 INFO] 

epoch 10
