[2024-03-04 14:17:01,156 INFO] Use GPU: None for training
[2024-03-04 14:17:01,157 INFO] 

[2024-03-04 14:17:02,925 INFO] Total params: 109.04M
[2024-03-04 14:17:13,323 INFO] acc: 0.90
[2024-03-04 14:17:13,337 INFO] Victim model accuracy = 0.9016, spec = 0.90, sens = 0.93
[2024-03-04 14:17:13,337 INFO] Loading thief dataset ...
[2024-03-04 14:17:13,342 INFO] 
Initializing thief model ...


Loaded supervised labeled set of length  900
Labeled set expanded to length  3600 , unique indices  900
dataset root /home/deepankar/mnt/vision3_data_ckpts_msa_medical/GBUSV-Shared
Num of videos 64 frames 15800
15800
15800
Num of videos 64 frames 15800
  0%|          | 0/29 [00:00<?, ?it/s]  3%|â–Ž         | 1/29 [00:08<03:45,  8.05s/it]  7%|â–‹         | 2/29 [00:10<02:04,  4.62s/it] 10%|â–ˆ         | 3/29 [00:12<01:33,  3.58s/it] 14%|â–ˆâ–        | 4/29 [00:14<01:14,  2.97s/it] 17%|â–ˆâ–‹        | 5/29 [00:17<01:08,  2.85s/it] 21%|â–ˆâ–ˆ        | 6/29 [00:19<01:03,  2.74s/it] 24%|â–ˆâ–ˆâ–       | 7/29 [00:22<00:58,  2.66s/it] 28%|â–ˆâ–ˆâ–Š       | 8/29 [00:24<00:53,  2.55s/it] 31%|â–ˆâ–ˆâ–ˆ       | 9/29 [00:26<00:48,  2.44s/it] 34%|â–ˆâ–ˆâ–ˆâ–      | 10/29 [00:29<00:45,  2.39s/it] 38%|â–ˆâ–ˆâ–ˆâ–Š      | 11/29 [00:31<00:40,  2.25s/it] 41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 12/29 [00:33<00:39,  2.33s/it] 45%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 13/29 [00:35<00:35,  2.24s/it] 48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 14/29 [00:37<00:33,  2.21s/it] 52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 15/29 [00:40<00:31,  2.24s/it] 55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 16/29 [00:42<00:29,  2.28s/it] 59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 17/29 [00:44<00:27,  2.26s/it] 62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 18/29 [00:46<00:24,  2.20s/it] 66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 19/29 [00:48<00:21,  2.14s/it] 69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 20/29 [00:50<00:17,  2.00s/it] 72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 21/29 [00:51<00:15,  1.90s/it] 76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 22/29 [00:53<00:13,  1.89s/it] 79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 23/29 [00:56<00:11,  1.99s/it] 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 24/29 [00:58<00:09,  1.99s/it] 86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 25/29 [01:00<00:08,  2.09s/it] 90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 26/29 [01:02<00:06,  2.07s/it] 93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 27/29 [01:04<00:04,  2.07s/it] 97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 28/29 [01:06<00:02,  2.10s/it]100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 29/29 [01:08<00:00,  2.03s/it]100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 29/29 [01:08<00:00,  2.37s/it]
Num of videos 64 frames 15800
  0%|          | 0/1 [00:00<?, ?it/s]100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1/1 [00:04<00:00,  4.89s/it]100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1/1 [00:04<00:00,  4.95s/it]
[2024-03-04 14:18:27,005 INFO] unlabeled data number: 15800, labeled data number 3600
[2024-03-04 14:18:27,005 INFO] Create train and test data loaders
[2024-03-04 14:18:27,005 INFO] [!] data loader keys: dict_keys(['train_lb', 'train_ulb', 'eval', 'test'])
[2024-03-04 14:18:29,684 INFO] Create optimizer and scheduler
Num of videos 64 frames 15800
[2024-03-04 14:18:36,299 INFO] Number of Trainable Params: 85800963
logit adjustments:  tensor([-2.1873, -1.4179, -0.4376], device='cuda:0')
Load pretrained model for initializing the thief from  /home/deepankar/scratch/MSA_Medical/activethief/pretrained/deit_base_patch16_224-b5f2ef4d.pth
key not found head.weight
key not found head.bias
Common keys pretrained model:  150
Load anchor model /home/deepankar/mnt/vision1_outputs/gbusg_radformer/GBUSV_deit/SGD/1000_val100/random_v1_transforms/trial_5_cycle_1_best.pth
thief state:  ['cls_token', 'pos_embed', 'patch_embed.proj.weight', 'patch_embed.proj.bias', 'blocks.0.norm1.weight']
pretrained state:  ['cls_token', 'pos_embed', 'patch_embed.proj.weight', 'patch_embed.proj.bias', 'blocks.0.norm1.weight']
Common keys anchor model:  152
[2024-03-04 14:18:46,473 INFO] Anchor model on target dataset: acc = 0.6721, spec = 0.61, sens = 0.88
[2024-03-04 14:18:47,016 INFO] Arguments: Namespace(T=0.5, algorithm='selfkd', amp=False, batch_size=16, c='configs/gbc/selfkd_deit.yaml', clip=0.0, clip_grad=0, crop_ratio=0.875, data_dir='./data', dataset='GBUSV', device=device(type='cuda'), dist_backend='nccl', dist_url='tcp://127.0.0.1:25379', distributed=False, ds_seed=123, ema_m=0.999, epoch=100, eval_batch_size=16, eval_step=234, expand_labels=True, gpu=None, hard_label=True, imb_algorithm=None, img_size=224, include_lb_to_ulb=True, kd_alpha=0.4, kd_alpha_ulb=0.5, kd_temp=1.5, kd_temp_ulb=1.5, la=True, labeled_set_path='/home/deepankar/mnt/vision1_outputs/gbusg_radformer/GBUSV_deit/SGD/1000_val100/random_v1_transforms/X_trial_5_cycle_1_labeled_set.npy', layer_decay=0.5, lb_dest_len=3600, lb_imb_ratio=1, load_labeled_set=True, load_path=None, local_rank=-1, lr=0.01, max_length=512, max_length_seconds=4.0, momentum=0.9, multiprocessing_distributed=False, net='deit_base_patch16_224', net_from_name=False, no_progress=True, num_classes=3, num_eval_iter=234, num_labels=1000, num_log_iter=234, num_train_iter=900000, num_warmup_iter=5120, num_workers=4, optim='SGD', overwrite=True, p_cutoff=0.95, pretrain_path='', pretrained_dir='/home/deepankar/scratch/MSA_Medical/activethief/pretrained/deit_base_patch16_224-b5f2ef4d.pth', rank=0, resume=False, sample_rate=16000, save_dir='/home/deepankar/mnt/vision03_ssl/radformer', save_name='selfkd_deit_v8_exp4_5_ur3', scheduler_type='cosine', seed=5, subset=128116, thief_root='/home/deepankar/mnt/vision3_data_ckpts_msa_medical/GBUSV-Shared', train_sampler='RandomSampler', tro=1, ulb_dest_len=15800, ulb_imb_ratio=1, ulb_loss_ratio=1.0, ulb_num_labels=None, uratio=3, use_aim=False, use_cat=True, use_pretrain=True, use_tensorboard=True, use_wandb=True, val_set_path='/home/deepankar/mnt/vision1_outputs/gbusg_radformer/GBUSV_deit/SGD/1000_val100/random_v1_transforms/X_trial_5_cycle_1_val_set.npy', victim_arch='radformer', victim_data_root='/home/deepankar/mnt/vision3_data_ckpts_msa_medical/GBCU-Shared', victim_dataset='gbusg', victim_model_path='/home/deepankar/mnt/vision3_data_ckpts_msa_medical/victim_models/radformer/radformer.pkl', warmstart=False, warmstart_dir='/home/deepankar/mnt/vision1_outputs/gbusg_radformer/GBUSV_deit/SGD/1000_val100/random_v1_transforms/trial_5_cycle_1_best.pth', warmup=0, warmup_epoch=10, weight_decay=0.0005, world_size=1)
[2024-03-04 14:18:47,017 INFO] Validation set distribution: 
anchor model temp =  1.0
Number of samples  100
[2024-03-04 14:18:47,667 INFO] {0: 11, 1: 20, 2: 69}
[2024-03-04 14:18:47,668 INFO] Labeled set distribution: 
Number of samples  3600
[2024-03-04 14:18:54,305 INFO] {0: 404, 1: 872, 2: 2324}
[2024-03-04 14:18:58,391 INFO] Initial model on target dataset (without EMA): acc = 0.3934, agreement = 0.3689, spec = 0.74, sens = 0.31
[2024-03-04 14:18:58,391 INFO] Resume load path None does not exist
[2024-03-04 14:18:58,391 INFO] 
Model training
wandb: Currently logged in as: satwikdpshrit. Use `wandb login --relogin` to force relogin
wandb: - Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: Tracking run with wandb version 0.16.3
wandb: Run data is saved locally in /home/deepankar/mnt/vision03_ssl/radformer/wandb/selfkd_deit_v8_exp4_5_ur3/wandb/run-20240304_141900-695nga2d
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run selfkd_deit_v8_exp4_5_ur3
wandb: â­ï¸ View project at https://wandb.ai/satwikdpshrit/radformer
wandb: ðŸš€ View run at https://wandb.ai/satwikdpshrit/radformer/runs/695nga2d
[2024-03-04 14:19:03,864 INFO] 

epoch 0
[2024-03-04 14:24:37,875 INFO] validating...
[2024-03-04 14:24:58,785 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/latest_model.pth
[2024-03-04 14:25:09,017 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/model_best.pth
[2024-03-04 14:25:09,018 INFO] 226 iteration, USE_EMA: True, train/sup_loss: 1.33007, train/unsup_loss: 0.99053, train/total_loss: 2.32059, train/util_ratio: 0.87500, train/run_time: 1.44243, lr: 0.00000, train/prefecth_time: 0.01502, eval/loss: 1.13083, eval/top-1-acc: 0.25000, eval/balanced_acc: 0.32198, eval/precision: 0.33413, eval/recall: 0.32198, eval/F1: 0.17648, eval/spec: 0.93548, eval/sens: 0.11594, test/loss: 1.04015, test/top-1-acc: 0.39344, test/balanced_acc: 0.34522, test/precision: 0.42590, test/recall: 0.34522, test/F1: 0.30214, test/spec: 0.73750, test/sens: 0.30952 BEST_EVAL_ACC: 0.2500, at 226 iters BEST_TEST_ACC: 0.3934, at 226 iters
[2024-03-04 14:25:09,030 INFO] 

epoch 1
[2024-03-04 14:30:43,307 INFO] validating...
[2024-03-04 14:31:25,825 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/latest_model.pth
[2024-03-04 14:31:54,744 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/model_best.pth
[2024-03-04 14:31:54,746 INFO] 451 iteration, USE_EMA: True, train/sup_loss: 0.76571, train/unsup_loss: 0.66024, train/total_loss: 1.42595, train/util_ratio: 0.87500, train/run_time: 1.44447, lr: 0.00100, train/prefecth_time: 0.01184, eval/loss: 0.88731, eval/top-1-acc: 0.65000, eval/balanced_acc: 0.61711, eval/precision: 0.59726, eval/recall: 0.61711, eval/F1: 0.56236, eval/spec: 0.96774, eval/sens: 0.63768, test/loss: 0.98576, test/top-1-acc: 0.52459, test/balanced_acc: 0.47107, test/precision: 0.52963, test/recall: 0.47107, test/F1: 0.42293, test/spec: 0.78750, test/sens: 0.66667 BEST_EVAL_ACC: 0.6500, at 451 iters BEST_TEST_ACC: 0.5246, at 451 iters
[2024-03-04 14:31:54,757 INFO] 

epoch 2
[2024-03-04 14:37:28,369 INFO] validating...
[2024-03-04 14:37:56,643 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/latest_model.pth
[2024-03-04 14:38:29,785 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/model_best.pth
[2024-03-04 14:38:29,786 INFO] 676 iteration, USE_EMA: True, train/sup_loss: 0.57849, train/unsup_loss: 0.49258, train/total_loss: 1.07106, train/util_ratio: 0.83333, train/run_time: 1.44094, lr: 0.00200, train/prefecth_time: 0.01226, eval/loss: 0.78697, eval/top-1-acc: 0.69000, eval/balanced_acc: 0.67734, eval/precision: 0.62284, eval/recall: 0.67734, eval/F1: 0.62778, eval/spec: 0.90323, eval/sens: 0.69565, test/loss: 0.93393, test/top-1-acc: 0.53279, test/balanced_acc: 0.48014, test/precision: 0.52857, test/recall: 0.48014, test/F1: 0.42807, test/spec: 0.75000, test/sens: 0.71429 BEST_EVAL_ACC: 0.6900, at 676 iters BEST_TEST_ACC: 0.5328, at 676 iters
[2024-03-04 14:38:29,804 INFO] 

epoch 3
[2024-03-04 14:44:03,980 INFO] validating...
[2024-03-04 14:44:43,944 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/latest_model.pth
[2024-03-04 14:45:11,282 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/model_best.pth
[2024-03-04 14:45:11,284 INFO] 901 iteration, USE_EMA: True, train/sup_loss: 0.45829, train/unsup_loss: 0.55908, train/total_loss: 1.01736, train/util_ratio: 0.85417, train/run_time: 1.45383, lr: 0.00300, train/prefecth_time: 0.01133, eval/loss: 0.66474, eval/top-1-acc: 0.75000, eval/balanced_acc: 0.69449, eval/precision: 0.63789, eval/recall: 0.69449, eval/F1: 0.65752, eval/spec: 0.87097, eval/sens: 0.79710, test/loss: 0.88311, test/top-1-acc: 0.56557, test/balanced_acc: 0.52937, test/precision: 0.65101, test/recall: 0.52937, test/F1: 0.51390, test/spec: 0.68750, test/sens: 0.76190 BEST_EVAL_ACC: 0.7500, at 901 iters BEST_TEST_ACC: 0.5656, at 901 iters
[2024-03-04 14:45:11,298 INFO] 

epoch 4
[2024-03-04 14:50:45,874 INFO] validating...
[2024-03-04 14:51:23,225 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/latest_model.pth
[2024-03-04 14:51:37,008 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/model_best.pth
[2024-03-04 14:51:37,011 INFO] 1126 iteration, USE_EMA: True, train/sup_loss: 0.42828, train/unsup_loss: 0.42376, train/total_loss: 0.85203, train/util_ratio: 0.79167, train/run_time: 1.43899, lr: 0.00400, train/prefecth_time: 0.01282, eval/loss: 0.57791, eval/top-1-acc: 0.77000, eval/balanced_acc: 0.75329, eval/precision: 0.71537, eval/recall: 0.75329, eval/F1: 0.71910, eval/spec: 0.93548, eval/sens: 0.78261, test/loss: 0.85312, test/top-1-acc: 0.56557, test/balanced_acc: 0.54067, test/precision: 0.62951, test/recall: 0.54067, test/F1: 0.52890, test/spec: 0.63750, test/sens: 0.83333 BEST_EVAL_ACC: 0.7700, at 1126 iters BEST_TEST_ACC: 0.5656, at 1126 iters
[2024-03-04 14:51:37,027 INFO] 

epoch 5
[2024-03-04 14:57:11,171 INFO] validating...
[2024-03-04 14:57:46,160 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/latest_model.pth
[2024-03-04 14:57:58,789 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/model_best.pth
[2024-03-04 14:57:58,790 INFO] 1351 iteration, USE_EMA: True, train/sup_loss: 0.29184, train/unsup_loss: 0.44618, train/total_loss: 0.73802, train/util_ratio: 0.79167, train/run_time: 1.44391, lr: 0.00500, train/prefecth_time: 0.01255, eval/loss: 0.51116, eval/top-1-acc: 0.83000, eval/balanced_acc: 0.81959, eval/precision: 0.78209, eval/recall: 0.81959, eval/F1: 0.79484, eval/spec: 0.87097, eval/sens: 0.84058, test/loss: 0.85788, test/top-1-acc: 0.59016, test/balanced_acc: 0.58028, test/precision: 0.64322, test/recall: 0.58028, test/F1: 0.57072, test/spec: 0.61250, test/sens: 0.90476 BEST_EVAL_ACC: 0.8300, at 1351 iters BEST_TEST_ACC: 0.5902, at 1351 iters
[2024-03-04 14:57:58,803 INFO] 

epoch 6
[2024-03-04 15:03:34,633 INFO] validating...
[2024-03-04 15:03:58,193 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/latest_model.pth
[2024-03-04 15:04:16,642 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/model_best.pth
[2024-03-04 15:04:16,644 INFO] 1576 iteration, USE_EMA: True, train/sup_loss: 0.23326, train/unsup_loss: 0.48122, train/total_loss: 0.71447, train/util_ratio: 0.89583, train/run_time: 1.44783, lr: 0.00600, train/prefecth_time: 0.01570, eval/loss: 0.43142, eval/top-1-acc: 0.87000, eval/balanced_acc: 0.83891, eval/precision: 0.81774, eval/recall: 0.83891, eval/F1: 0.82696, eval/spec: 0.87097, eval/sens: 0.89855, test/loss: 0.88184, test/top-1-acc: 0.57377, test/balanced_acc: 0.57062, test/precision: 0.64577, test/recall: 0.57062, test/F1: 0.56142, test/spec: 0.57500, test/sens: 0.90476 BEST_EVAL_ACC: 0.8700, at 1576 iters BEST_TEST_ACC: 0.5738, at 1576 iters
[2024-03-04 15:04:16,666 INFO] 

epoch 7
[2024-03-04 15:09:51,764 INFO] validating...
[2024-03-04 15:10:09,137 INFO] model saved: /home/deepankar/mnt/vision03_ssl/radformer/selfkd_deit_v8_exp4_5_ur3/latest_model.pth
[2024-03-04 15:10:09,139 INFO] 1801 iteration, USE_EMA: True, train/sup_loss: 0.09543, train/unsup_loss: 0.35619, train/total_loss: 0.45163, train/util_ratio: 0.85417, train/run_time: 1.44570, lr: 0.00700, train/prefecth_time: 0.01977, eval/loss: 0.40394, eval/top-1-acc: 0.87000, eval/balanced_acc: 0.80160, eval/precision: 0.81394, eval/recall: 0.80160, eval/F1: 0.80705, eval/spec: 0.83871, eval/sens: 0.92754, test/loss: 0.91187, test/top-1-acc: 0.56557, test/balanced_acc: 0.56382, test/precision: 0.66757, test/recall: 0.56382, test/F1: 0.55548, test/spec: 0.51250, test/sens: 0.90476 BEST_EVAL_ACC: 0.8700, at 1576 iters BEST_TEST_ACC: 0.5738, at 1576 iters
[2024-03-04 15:10:09,157 INFO] 

epoch 8
